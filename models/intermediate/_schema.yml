version: 2

models:
  - name: int_sales_fact
    description: "Order-level fact table built from FactInternetSales."
    columns:
      - name: sales_order_number
        description: "Order number."
        tests: [not_null, unique]
      - name: customer_key
        description: "Customer surrogate key for this order."
        tests:
          - not_null
          - relationships:
              to: ref('customers__dim_customer')
              field: customer_key
      - name: order_amount
        description: "Total sales amount per order."
        tests:
          - percent_nulls_under_threshold:
              column_name: order_amount
              max_pct: 0.01
      - name: updated_at
        description: "fake update timestamp since db does not have a real one (not a good one though)"
        tests: [not_null]
      - name: line_count
        description: "No items (type) per order"
        tests: 
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
  - name: tot_sales_fact
    description: "Combined fact table built from FactInternetSales and FactResellerSales."
    columns:
      - name: sales_order_number
        description: "Order number."
        tests: [not_null]
      - name: order_date
        description: "Order date."
        tests: [not_null]
      - name: sales_amount
        description: "Order price."
        tests: [not_null]
      - name: order_quantity
        description: "Order quantity."
        tests: [not_null]
      - name: product_key
        description: "FK to products__dim_product."
        tests: [not_null]